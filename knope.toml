[package]
versioned_files = [
    "octomil/python/pyproject.toml",
    { path = "setup.py", regex = 'version="(?<version>\d+\.\d+\.\d+)"' },
    { path = "octomil/__init__.py", regex = '__version__ = "(?<version>\d+\.\d+\.\d+)"' },
    { path = "homebrew/octomil.rb", regex = 'version "(?<version>\d+\.\d+\.\d+)"' },
    { path = "tests/test_cli.py", regex = '"(?<version>\d+\.\d+\.\d+)" in result' },
]
changelog = "CHANGELOG.md"

[[workflows]]
name = "release"

[[workflows.steps]]
type = "Command"
command = "git switch -c release"

[[workflows.steps]]
type = "PrepareRelease"

[[workflows.steps]]
type = "Command"
command = "git add -A"

[[workflows.steps]]
type = "Command"
command = "git commit -m 'chore: prepare release $version'"

[[workflows.steps]]
type = "Command"
command = "git push --force --set-upstream origin release"

[[workflows.steps]]
type = "CreatePullRequest"
base = "main"

[workflows.steps.title]
template = "chore: release v$version"

[workflows.steps.body]
template = "Automated release PR created by Knope.\n\n$changelog"

[[workflows]]
name = "release-pr-merged"

[[workflows.steps]]
type = "Release"

[github]
owner = "octomil"
repo = "octomil-python"
